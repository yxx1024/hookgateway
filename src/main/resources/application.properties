spring.application.name=hookgateway

# ===========================================
# 数据库配置 (默认为 H2 内存数据库)
# ===========================================

# -------------------------------------------
# 方式一：H2 内存数据库 (出厂默认)
# 适用场景：本地快速开发、演示、Docker 单机非持久化
# 特点：重启后数据会丢失，无需安装额外数据库
# -------------------------------------------
spring.datasource.url=${DB_URL:jdbc:h2:mem:webhookdb;DB_CLOSE_DELAY=-1}
spring.datasource.driverClassName=${DB_DRIVER:org.h2.Driver}
spring.datasource.username=${DB_USERNAME:sa}
spring.datasource.password=${DB_PASSWORD:}

# -------------------------------------------
# 方式二：MySQL 数据库 (生产环境推荐)
# 适用场景：正式部署、数据需要持久化保存
# 
# 使用方法：
# 1. 推荐：使用环境变量添加 DB_URL 等，这样不用改这个文件。
# 2. 或者：注释掉上面 H2 的配置，并在下方填写您的 MySQL 信息（去掉注释）。
# -------------------------------------------
# spring.datasource.url=jdbc:mysql://localhost:3306/webhook?useSSL=false&serverTimezone=UTC&allowPublicKeyRetrieval=true
# spring.datasource.driverClassName=com.mysql.cj.jdbc.Driver
# spring.datasource.username=root
# spring.datasource.password=123456

# H2 Console (生产环境建议禁用)
spring.h2.console.enabled=${H2_CONSOLE_ENABLED:false}
spring.h2.console.path=/h2-console

# JPA
spring.jpa.hibernate.ddl-auto=update
spring.jpa.show-sql=${JPA_SHOW_SQL:false}

# Server
server.port=${SERVER_PORT:8080}
server.error.include-stacktrace=never
server.error.include-message=never
server.error.include-binding-errors=never

# i18n
spring.messages.basename=i18n/messages

# Thymeleaf (Development)
spring.thymeleaf.cache=false

# ===========================================
# Spring Boot Actuator Configuration
# ===========================================
management.endpoints.web.exposure.include=health,metrics,info,prometheus
management.endpoint.health.show-details=when_authorized
management.metrics.enable.jvm=true
management.metrics.enable.process=true
management.metrics.enable.system=true
management.metrics.distribution.percentiles-histogram.http.server.requests=true

# ===========================================
# Redis 配置 (分布式部署需开启)
# ===========================================
# 默认从环境变量读取，如果没有则使用 localhost
spring.data.redis.host=${REDIS_HOST:localhost}
spring.data.redis.port=${REDIS_PORT:6379}
spring.data.redis.password=${REDIS_PASSWORD:}

# Redis 先使用示例 (小白专用)
# 如果您不想配环境变量，可以直接在这里写死 (去掉注释生效):
# -------------------------------------------
# spring.data.redis.host=192.168.1.100
# spring.data.redis.port=6379
# spring.data.redis.password=secret123

# ===========================================
# Webhook 分发模式配置
# ===========================================
# op 1: async (默认) -> 使用 Java 内存队列。简单，但重启会丢未发消息，不支持多实例。
# op 2: redis       -> 使用 Redis Stream。支持多实例负载均衡，消息不丢失。
# -------------------------------------------
app.distribution.mode=${DISTRIBUTION_MODE:async}

# ===========================================
# 摄入模式配置 (Write-Behind Performance)
# ===========================================
# sync (默认): 同步写入数据库，返回 200 OK。数据最安全。
# redis: 异步写入 Redis Stream，返回 202 Accepted。吞吐量最高。
# -------------------------------------------
app.ingest.mode=${INGEST_MODE:sync}
app.ingest.stream.key=${INGEST_STREAM_KEY:webhook:events:ingest}

# ===========================================
# 安全加固配置
# ===========================================
# WebSocket 允许的来源 (生产环境务必修改，支持逗号分隔)
app.security.websocket.allowed-origins=${WS_ALLOWED_ORIGINS:*}
# 禁止转发到的内网 IP 范围 (逗号分隔)
app.security.ssrf.blocked-ips=${SSRF_BLOCKED_IPS:127.0.0.1,localhost,10.0.0.0/8,172.16.0.0/12,192.168.0.0/16,169.254.169.254,0.0.0.0}

# 生产环境安全限制
spring.servlet.multipart.max-file-size=5MB
spring.servlet.multipart.max-request-size=5MB
# 限制内存中的请求体大小（针对 IngestController 的 @RequestBody）
server.max-http-request-header-size=16KB

